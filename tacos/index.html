<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon@0.6.2/build/cannon.js"></script>
    <script src="DragControls.js"></script>
    <script type="module">
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        var world = new CANNON.World();
        world.gravity.set(0, 0, -9.82);

        var groundShape = new CANNON.Plane();
        var groundBody = new CANNON.Body({ mass: 0 });
        groundBody.addShape(groundShape);
        groundBody.position.set(100, 100, 100);
        world.addBody(groundBody);

        /*var cubeShape = new CANNON.Box(new CANNON.Vec3(0.5, 0.5, 0.5));
        var cubeBody = new CANNON.Body({ mass: 1 });
        cubeBody.addShape(cubeShape);
        cubeBody.position.set(0, 1, 5);
        world.addBody(cubeBody);*/

        var geometry = new THREE.BoxGeometry();
        var material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        var cube = new THREE.Mesh(geometry, material);
        scene.add(cube);

        var circleGeometry = new THREE.CircleGeometry(1, 32);
        var circleMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        var circle = new THREE.Mesh(circleGeometry, circleMaterial);
        circle.position.set(0, -1.5, -5);
        scene.add(circle);

        let objects = [cube]

        var dragControls = new THREE.DragControls(objects, camera, renderer.domElement);
        var previousY;

        var listeCubePhysique = []
        var listeCubeThree = []

        renderer.domElement.addEventListener('contextmenu', function(event) {
            event.preventDefault();
            console.log("Clic droit");
            createNewCube()
            
        });

        function createNewCube() {
            let cubeShape = new CANNON.Box(new CANNON.Vec3(0.5, 0.5, 0.5));
            let cubeBody = new CANNON.Body({ mass: 1 });
            cubeBody.addShape(cubeShape);
            console.log(cube.position);
            cubeBody.position.set(cube.position.x, cube.position.y, 5);
            listeCubePhysique.push(cubeBody)
            world.addBody(cubeBody);

            let geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
            let material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            let cube2 = new THREE.Mesh(geometry, material);
            listeCubeThree.push(cube2)
            scene.add(cube2);
        }

        camera.position.z = 5;

        function animate() {
            requestAnimationFrame(animate);
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;

            groundBody.position.copy(circle.position);
            world.step(1 / 60);
            for (let i = 0; i < listeCubeThree.length; i++) {
                listeCubeThree[i].position.copy(listeCubePhysique[i].position);
            }

            renderer.render(scene, camera);
        }

        animate();
        
    </script>
</body>
</html>
